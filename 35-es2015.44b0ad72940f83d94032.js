(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{"17v1":function(t,e,a){"use strict";a.r(e),a.d(e,"PublisherApiModule",(function(){return F}));var r=a("ofXK"),n=a("tyNb"),c=a("fXoL");let i=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Kb({type:t,selectors:[["app-publisher-api"]],decls:1,vars:0,template:function(t,e){1&t&&c.Rb(0,"router-outlet")},directives:[n.l],styles:[""]}),t})();var s=a("mrSG"),o=a("oabR"),l=a("AytR"),p=a("tk/3");const h=l.a.apiUrl+"/publisher-api";let u=(()=>{class t{constructor(t){this.http=t}getPublisherAPIStats(t,e,a,r,n){return this.http.get(h+"/",{params:{company:t,apiKey:e,tag:a,startDate:r,endDate:n}})}getSummaryMetrics(t,e,a){return this.http.get(h+"/summary_metrics",{params:{company:t,startDate:e,endDate:a}})}}return t.\u0275fac=function(e){return new(e||t)(c.ec(p.c))},t.\u0275prov=c.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var b=a("SHm6"),d=a("3awX"),g=a("/X+5"),m=a("lDzL"),f=a("PTT0");const v=["expandableTable"];function y(t,e){if(1&t&&c.Rb(0,"app-reporting-publisher-revenue-chart",16),2&t){const t=c.lc();c.rc("chartData",t.chartData)}}function D(t,e){1&t&&c.Oc(0," Date ")}function P(t,e){if(1&t&&(c.Wb(0,"strong"),c.Oc(1),c.mc(2,"date"),c.Vb()),2&t){const t=e.value;c.Db(1),c.Pc(c.nc(2,1,t))}}function M(t,e){1&t&&c.Oc(0," Subid ")}function I(t,e){if(1&t&&(c.Wb(0,"strong"),c.Oc(1),c.Vb()),2&t){const t=e.value;c.Db(1),c.Pc(t)}}function w(t,e){1&t&&c.Oc(0," Clicks ")}function O(t,e){if(1&t&&(c.Wb(0,"strong"),c.Oc(1),c.mc(2,"number"),c.Vb()),2&t){const t=e.value;c.Db(1),c.Pc(c.nc(2,1,t))}}function S(t,e){1&t&&c.Oc(0," Searches ")}function x(t,e){if(1&t&&(c.Wb(0,"strong"),c.Oc(1),c.Vb()),2&t){const t=e.value;c.Db(1),c.Pc(t)}}function V(t,e){1&t&&c.Oc(0," Country ")}function k(t,e){if(1&t&&(c.Wb(0,"strong"),c.Oc(1),c.Vb()),2&t){const t=e.value;c.Db(1),c.Pc(t)}}function C(t,e){1&t&&c.Oc(0," CPC ")}function T(t,e){if(1&t&&(c.Wb(0,"strong"),c.Oc(1),c.mc(2,"currency"),c.mc(3,"currency"),c.Vb()),2&t){const t=e.value;c.Db(1),c.Pc(c.oc(2,1,t,"USD")||c.oc(3,4,0,"USD"))}}function W(t,e){1&t&&c.Oc(0," CTR ")}function A(t,e){if(1&t&&(c.Wb(0,"strong"),c.Oc(1),c.mc(2,"percent"),c.mc(3,"percent"),c.Vb()),2&t){const t=e.value;c.Db(1),c.Pc(c.oc(2,1,t,"1.2-2")||c.oc(3,4,0,"1.2-2"))}}function R(t,e){1&t&&c.Oc(0," Revenue ")}function K(t,e){if(1&t&&(c.Wb(0,"strong"),c.Oc(1),c.mc(2,"currency"),c.Vb()),2&t){const t=e.value;c.Db(1),c.Pc(c.oc(2,1,t,"USD"))}}const Q=[{path:"",component:i,children:[{path:":fullname/:apiKey/:tagId",component:(()=>{class t{constructor(t,e,a,r,n,c,i,s,o){this.route=t,this.cdr=e,this.userService=a,this.publisherApiService=r,this.exportDataService=n,this.datePipe=c,this.currencyPipe=i,this.percentPipe=s,this.tagManagementService=o,this.loadingIndicator=!0,this.statData=[],this.range={startDate:"",endDate:""},this.selectedCompany=this.getSelectedCompanyFromLocalStorage()}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,(function*(){this.route.params.subscribe(t=>Object(s.a)(this,void 0,void 0,(function*(){this.paramTagId=t.tagId,this.paramApiKey=t.apiKey,this.tagRows=yield this.getTagInformation(t.tagId),this.statData=[],this.statData=yield this.getPublisherAPIData(this.selectedCompany,this.paramApiKey,this.paramTagId,this.range.startDate,this.range.endDate),this.chartData=yield this.getChartMetrics(this.selectedCompany,this.paramApiKey,this.paramTagId,this.range.startDate,this.range.endDate),this.loadingIndicator=!1,this.cdr.markForCheck()})))}))}getTagInformation(t){return this.tagManagementService.getOneTag(t).toPromise().then(t=>t).catch(t=>t)}getChartMetrics(t,e,a,r,n){return Object(s.a)(this,void 0,void 0,(function*(){try{const b=yield this.publisherApiService.getPublisherAPIStats(t,e,a,r,n).toPromise();var c={},i=b.reduce((function(t,e){var a=e.date;return c[a]?(c[a].searches+=parseInt(e.searches),e.revenue&&(c[a].revenue+=parseFloat(e.revenue))):(c[a]=Object.assign({},e),t.push(c[a])),t}),[]),s=[],o=[],l=[],p=[],h={};for(var u of i)s.push(0),o.push(u.revenue),l.push(u.date),p.push(u.searches);return h.revenuePerDay=s,h.publisherRevenuePerDay=o,h.datesOfRevenue=l,h.searchesPerDay=p,h}catch(b){return b}}))}exportToCsv(){let t=[];for(var e of this.statData){let a={date:this.datePipe.transform(e.date,"dd MMM yyyy"),subid:e.subid,country:e.country,clicks:e.clicks,searches:e.searches,cpc:this.currencyPipe.transform(e.cpc?e.cpc:0),ctr:this.percentPipe.transform(e.ctr,"1.2-2"),revenue:e.revenue};t.push(a)}this.exportDataService.exportToCsv(t,this.tagRows.nickName?this.tagRows.nickName:this.tagRows.name,["date","subid","country","clicks","searches","cpc","ctr","revenue"])}updateReportingFiltering(t){return Object(s.a)(this,void 0,void 0,(function*(){this.range=t,this.loadingIndicator=!0,this.statData=[],this.paramApiKey&&this.paramTagId&&(this.statData=yield this.getPublisherAPIData(this.selectedCompany,this.paramApiKey,this.paramTagId,this.range.startDate,this.range.endDate),this.chartData=yield this.getChartMetrics(this.selectedCompany,this.paramApiKey,this.paramTagId,this.range.startDate,this.range.endDate),this.loadingIndicator=!1,this.cdr.markForCheck())}))}getSelectedCompanyFromLocalStorage(){return this.userService.getSelectedCompanyFromLocalStorage()}getPublisherAPIData(t,e,a,r,n){return Object(s.a)(this,void 0,void 0,(function*(){try{return(yield this.publisherApiService.getPublisherAPIStats(t,e,a,r,n).toPromise()).slice().sort((t,e)=>e.date-t.date)}catch(c){return c}}))}toggleExpandRow(t){this.table.rowDetail.toggleExpandRow(t)}onDetailToggle(t){}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(n.a),c.Qb(c.i),c.Qb(o.a),c.Qb(u),c.Qb(b.a),c.Qb(r.f),c.Qb(r.d),c.Qb(r.w),c.Qb(d.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["app-tag-api"]],viewQuery:function(t,e){var a;1&t&&c.Tc(v,!0),2&t&&c.zc(a=c.ic())&&(e.table=a.first)},decls:31,vars:9,consts:[[3,"onDatesPicked"],[3,"chartData",4,"ngIf"],[1,"row","py-6"],[1,"btn","btn-sm","btn-primary","mx-3",3,"click"],[1,"material","fullscreen","expandable",2,"top","10px","height","500px",3,"loadingIndicator","columnMode","headerHeight","footerHeight","rowHeight","scrollbarV","scrollbarH","rows"],["expandableTable",""],["name","date"],["ngx-datatable-header-template",""],["ngx-datatable-cell-template",""],["name","subid"],["name","clicks"],["name","searches"],["name","country"],["name","cpc"],["name","ctr"],["name","revenue"],[3,"chartData"]],template:function(t,e){1&t&&(c.Wb(0,"app-reporting-filtering",0),c.hc("onDatesPicked",(function(t){return e.updateReportingFiltering(t)})),c.Vb(),c.Mc(1,y,1,1,"app-reporting-publisher-revenue-chart",1),c.Wb(2,"div",2),c.Wb(3,"button",3),c.hc("click",(function(){return e.exportToCsv()})),c.Oc(4," Export Stats "),c.Vb(),c.Vb(),c.Wb(5,"ngx-datatable",4,5),c.Wb(7,"ngx-datatable-column",6),c.Mc(8,D,1,0,"ng-template",7),c.Mc(9,P,3,3,"ng-template",8),c.Vb(),c.Wb(10,"ngx-datatable-column",9),c.Mc(11,M,1,0,"ng-template",7),c.Mc(12,I,2,1,"ng-template",8),c.Vb(),c.Wb(13,"ngx-datatable-column",10),c.Mc(14,w,1,0,"ng-template",7),c.Mc(15,O,3,3,"ng-template",8),c.Vb(),c.Wb(16,"ngx-datatable-column",11),c.Mc(17,S,1,0,"ng-template",7),c.Mc(18,x,2,1,"ng-template",8),c.Vb(),c.Wb(19,"ngx-datatable-column",12),c.Mc(20,V,1,0,"ng-template",7),c.Mc(21,k,2,1,"ng-template",8),c.Vb(),c.Wb(22,"ngx-datatable-column",13),c.Mc(23,C,1,0,"ng-template",7),c.Mc(24,T,4,7,"ng-template",8),c.Vb(),c.Wb(25,"ngx-datatable-column",14),c.Mc(26,W,1,0,"ng-template",7),c.Mc(27,A,4,7,"ng-template",8),c.Vb(),c.Wb(28,"ngx-datatable-column",15),c.Mc(29,R,1,0,"ng-template",7),c.Mc(30,K,3,4,"ng-template",8),c.Vb(),c.Vb()),2&t&&(c.Db(1),c.rc("ngIf",e.chartData),c.Db(4),c.rc("loadingIndicator",e.loadingIndicator)("columnMode","force")("headerHeight",50)("footerHeight",0)("rowHeight",50)("scrollbarV",!0)("scrollbarH",!0)("rows",e.statData))},directives:[g.a,r.p,m.d,m.b,m.c,m.a,f.a],pipes:[r.f,r.g,r.d,r.w],styles:[""]}),t})(),pathMatch:"full"},{path:"",redirectTo:"",pathMatch:"full"},{path:"**",redirectTo:"",pathMatch:"full"}]}];let H=(()=>{class t{}return t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({factory:function(e){return new(e||t)},imports:[[n.k.forChild(Q)],n.k]}),t})();var j=a("UKGz");let F=(()=>{class t{}return t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({factory:function(e){return new(e||t)},providers:[r.f,r.w,r.d],imports:[[n.k,r.c,H,j.a,m.g]]}),t})()}}]);