{"version":3,"sources":["./src/app/modules/publisher-reporting/publisher-reporting-routing.module.ts","./src/app/modules/publisher-reporting/publisher-reporting.component.ts","./src/app/modules/publisher-reporting/publisher-reporting.component.html","./src/app/modules/publisher-reporting/publisher-reporting.module.ts","./src/app/modules/publisher-reporting/publisher/publisher.component.ts","./src/app/modules/publisher-reporting/publisher/publisher.component.html"],"names":[],"mappings":"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","file":"modules-publisher-reporting-publisher-reporting-module-es2015.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { PublisherReportingComponent } from './publisher-reporting.component';\nimport { PublisherComponent } from './publisher/publisher.component';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: PublisherReportingComponent,\n    children: [\n      {\n        path: ':tagId',\n        component: PublisherComponent,\n        pathMatch: 'full',\n      },\n      \n      { path: '', redirectTo: '', pathMatch: 'full' },\n      { path: '**', redirectTo: '', pathMatch: 'full' },\n    ]\n  }\n];\n\n@NgModule({\n  imports: [\n    RouterModule.forChild(routes)\n  ],\n  exports: [RouterModule]\n})\nexport class PublisherReportingRoutingModule { }\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'app-publisher-reporting',\n  templateUrl: './publisher-reporting.component.html',\n  styleUrls: ['./publisher-reporting.component.scss']\n})\nexport class PublisherReportingComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n  }\n\n}\n","<router-outlet></router-outlet>","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { PublisherReportingRoutingModule } from './publisher-reporting-routing.module';\nimport { PublisherComponent } from './publisher/publisher.component';\nimport { PublisherReportingComponent } from './publisher-reporting.component';\nimport { SharedModule } from 'src/app/shared/modules/shared.module';\n\n@NgModule({\n  declarations: [\n    PublisherComponent, \n    PublisherReportingComponent\n  ],\n  imports: [\n    RouterModule,\n    CommonModule,\n    PublisherReportingRoutingModule,\n    SharedModule\n  ],\n  entryComponents: [],\n})\nexport class PublisherReportingModule { }\n","import { Component, AfterViewInit, ChangeDetectorRef } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { TagInterface } from 'src/app/shared/models/tag.interface';\nimport { TagManagementService } from '../../tag-management/tag-management.service';\nimport { UsersService } from '../../../shared/service/users.service'\nimport { ChartDataInterface } from 'src/app/shared/models/chartData.interface';\nimport { PerionService } from 'src/app/shared/service/admin-stats/perion.service';\nimport { LyonService } from 'src/app/shared/service/admin-stats/lyon.service';\n\n@Component({\n  selector: 'app-publisher',\n  templateUrl: './publisher.component.html',\n  styleUrls: ['./publisher.component.scss']\n})\nexport class PublisherComponent implements AfterViewInit  {\n  loadingIndicator = true;\n  tagRows: TagInterface;\n  //Sends chartData to ReportingRevenueChartComponent\n  chartData: ChartDataInterface;\n  selectedCompany: any;\n  selectedAdvertiser: any;\n  allChart: any;\n  range = {\n    startDate: '',\n    endDate: '',\n  };\n\n  constructor(\n    private route: ActivatedRoute,\n    private tagManagementService: TagManagementService,\n    private cdr: ChangeDetectorRef,\n    private userService: UsersService,\n    private perionService: PerionService,\n    private lyonService: LyonService,\n  ) {}\n  \n  async ngAfterViewInit(){\n    this.route.params.subscribe(async routeParams => {\n      //console.log(\"routeParams===>\", routeParams)\n      this.tagRows = await this.getTagInformation(routeParams.tagId);\n      this.selectedAdvertiser = this.tagRows.advertiser;\n      this.selectedCompany = this.tagRows.company;\n     \n      if(this.selectedAdvertiser == \"lyons\") {\n        this.chartData = await this.getLyonChartMetrics(\n          this.selectedCompany,\n          this.range.startDate,\n          this.range.endDate\n        );\n        \n      } else if (this.selectedAdvertiser == \"perion\") {\n        this.chartData = await this.getPerionChartMetrics(\n          this.selectedCompany,\n          this.range.startDate,\n          this.range.endDate\n        );\n      }\n      this.refreshTable();\n    });\n    \n  }\n\n  getTagInformation(id: any) {\n    return this.tagManagementService.getOneTag(id).toPromise().then((response) => {\n      return response;\n    }).catch((error) => {\n      return error;\n    })\n  }\n\n  public async updateReportingFiltering(range) {\n    // console.log('Update report filtering....');\n    this.range = range;\n    if(this.selectedAdvertiser == \"lyons\") {\n      this.chartData = await this.getLyonChartMetrics(\n        this.selectedCompany,\n        this.range.startDate,\n        this.range.endDate\n      );\n    } else if (this.selectedAdvertiser == \"perion\") {\n      this.chartData = await this.getPerionChartMetrics(\n        this.selectedCompany,\n        this.range.startDate,\n        this.range.endDate\n      );\n    }\n    \n    this.refreshTable();\n  }\n\n  getLyonChartMetrics(company, startDate, endDate) {\n    return this.lyonService.getAllStats(startDate, endDate).toPromise().then((response) => {\n      this.allChart = response;\n      var chartAllLyonStat = [];\n      for(var tagSub of this.tagRows.subids) {\n        if(tagSub['filterTag'] ==\"Contains\") {\n              \n          chartAllLyonStat = chartAllLyonStat.concat(this.allChart.filter(stat => stat.subid.includes(tagSub['subid'])))\n        } else if (tagSub['filterTag'] ==\"StartsWith\") {\n          chartAllLyonStat = chartAllLyonStat.concat(this.allChart.filter(stat => stat.subid.startsWith(tagSub['subid'])))\n        } else if (tagSub['filterTag'] ==\"EndsWith\") {\n          chartAllLyonStat = chartAllLyonStat.concat(this.allChart.filter(stat => stat.subid.endsWith(tagSub['subid'])))\n        } else if (tagSub['filterTag'] ==\"ExactValue\") {\n          chartAllLyonStat = chartAllLyonStat.concat(this.allChart.filter(stat => stat.subid == tagSub['subid'] ))\n        }\n      }\n\n      //duplicated remove\n      let filter_data = chartAllLyonStat.filter((obj, pos, arr) => {\n        return arr\n          .map(mapObj => mapObj._id)\n          .indexOf(obj._id) == pos;\n      });\n      var helperChart = {};\n      filter_data.map(f =>{\n        f.revenue = parseFloat(f.revenue);\n        f.ctr = parseFloat(f.ctr);\n        f.biddedCtr = parseFloat(f.biddedCTR);\n      })\n      var resultChart = filter_data.reduce(function(r, o) {\n        var key = o.rptDate;\n        if(!helperChart[key]) {\n          helperChart[key] = Object.assign({}, o); // create a copy of o\n          r.push(helperChart[key]);\n        } else {\n          helperChart[key].searches += parseInt(o.searches);\n          if(o.revenue) {\n            helperChart[key].revenue += o.revenue;\n          }\n        } \n        return r;\n      }, []);\n      var revenuePerDayVal = [];\n      var datesOfRevenueVal = [];\n      var searchesPerDayVal = [];\n      var chartDataValue = {};\n      for(var resVal of resultChart) {\n        revenuePerDayVal.push(resVal.revenue);\n        datesOfRevenueVal.push(resVal.rptDate);\n        searchesPerDayVal.push(resVal.searches);\n      }\n      chartDataValue['revenuePerDay'] = revenuePerDayVal;\n      chartDataValue['datesOfRevenue'] = datesOfRevenueVal;\n      chartDataValue['searchesPerDay'] = searchesPerDayVal;\n      return chartDataValue;\n    })\n    .catch((error) => {\n      return error;\n    });\n\n  }\n  refreshTable() {\n    this.cdr.markForCheck();\n  }\n\n  getPerionChartMetrics(company, startDate, endDate) {\n    return this.perionService\n      .getChartMetrics(company, startDate, endDate)\n      .toPromise()\n      .then((response) => {\n        return response;\n      })\n      .catch((error) => {\n        return error;\n      });\n  }\n}\n","<app-reporting-filtering (onDatesPicked)=\"updateReportingFiltering($event)\"></app-reporting-filtering>\r\n<!-- Chart Part-->\r\n<app-reporting-revenue-chart *ngIf=\"chartData\"\r\n  [chartData]=\"chartData\"></app-reporting-revenue-chart>"],"sourceRoot":"webpack:///"}