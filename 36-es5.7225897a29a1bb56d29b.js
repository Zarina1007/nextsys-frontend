!function(){function t(t,n){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,n)}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,c=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw c}}}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{"17v1":function(e,r,i){"use strict";i.r(r),i.d(r,"PublisherApiModule",(function(){return q}));var c,o,s=i("ofXK"),u=i("tyNb"),l=i("fXoL"),p=((c=function(){function t(){n(this,t)}return a(t,[{key:"ngOnInit",value:function(){}}]),t}()).\u0275fac=function(t){return new(t||c)},c.\u0275cmp=l.Kb({type:c,selectors:[["app-publisher-api"]],decls:1,vars:0,template:function(t,e){1&t&&l.Rb(0,"router-outlet")},directives:[u.l],styles:[""]}),c),h=i("mrSG"),f=i("oabR"),b=i("AytR"),g=i("tk/3"),m=b.a.apiUrl+"/publisher-api",d=((o=function(){function t(e){n(this,t),this.http=e}return a(t,[{key:"getPublisherAPIStats",value:function(t,e,n,r,a){return this.http.get(m+"/",{params:{company:t,apiKey:e,tag:n,startDate:r,endDate:a}})}},{key:"getSummaryMetrics",value:function(t,e,n){return this.http.get(m+"/summary_metrics",{params:{company:t,startDate:e,endDate:n}})}}]),t}()).\u0275fac=function(t){return new(t||o)(l.ec(g.c))},o.\u0275prov=l.Mb({token:o,factory:o.\u0275fac,providedIn:"root"}),o),v=i("SHm6"),y=i("3awX"),D=i("/X+5"),w=i("lDzL"),k=i("PTT0"),x=["expandableTable"];function P(t,e){if(1&t&&l.Rb(0,"app-reporting-publisher-revenue-chart",17),2&t){var n=l.lc();l.rc("chartData",n.chartData)}}function M(t,e){1&t&&l.Oc(0," Date ")}function S(t,e){if(1&t&&(l.Wb(0,"strong"),l.Oc(1),l.mc(2,"date"),l.Vb()),2&t){var n=e.value;l.Db(1),l.Pc(l.nc(2,1,n))}}function I(t,e){1&t&&l.Oc(0," Subid ")}function O(t,e){if(1&t&&(l.Wb(0,"strong"),l.Oc(1),l.Vb()),2&t){var n=e.value;l.Db(1),l.Pc(n)}}function R(t,e){1&t&&l.Oc(0," Clicks ")}function V(t,e){if(1&t&&(l.Wb(0,"strong"),l.Oc(1),l.mc(2,"number"),l.Vb()),2&t){var n=e.value;l.Db(1),l.Pc(l.nc(2,1,n))}}function A(t,e){1&t&&l.Oc(0," Monetized Searches ")}function C(t,e){if(1&t&&(l.Wb(0,"strong"),l.Oc(1),l.mc(2,"number"),l.Vb()),2&t){var n=e.value;l.Db(1),l.Pc(l.nc(2,1,n))}}function T(t,e){1&t&&(l.Wb(0,"ngx-datatable-column",18),l.Mc(1,A,1,0,"ng-template",7),l.Mc(2,C,3,3,"ng-template",8),l.Vb())}function W(t,e){1&t&&l.Oc(0," Searches ")}function K(t,e){if(1&t&&(l.Wb(0,"strong"),l.Oc(1),l.Vb()),2&t){var n=e.value;l.Db(1),l.Pc(n)}}function j(t,e){1&t&&l.Oc(0," Country ")}function Q(t,e){if(1&t&&(l.Wb(0,"strong"),l.Oc(1),l.Vb()),2&t){var n=e.value;l.Db(1),l.Pc(n)}}function H(t,e){1&t&&l.Oc(0," CPC ")}function F(t,e){if(1&t&&(l.Wb(0,"strong"),l.Oc(1),l.mc(2,"currency"),l.mc(3,"currency"),l.Vb()),2&t){var n=e.value;l.Db(1),l.Pc(l.oc(2,1,n,"USD")||l.oc(3,4,0,"USD"))}}function z(t,e){1&t&&l.Oc(0," CTR ")}function U(t,e){if(1&t&&(l.Wb(0,"strong"),l.Oc(1),l.mc(2,"percent"),l.mc(3,"percent"),l.Vb()),2&t){var n=e.value;l.Db(1),l.Pc(l.oc(2,1,n,"1.2-2")||l.oc(3,4,0,"1.2-2"))}}function E(t,e){1&t&&l.Oc(0," Revenue ")}function L(t,e){if(1&t&&(l.Wb(0,"strong"),l.Oc(1),l.mc(2,"currency"),l.Vb()),2&t){var n=e.value;l.Db(1),l.Pc(l.oc(2,1,n,"USD"))}}var N,X,G,J=[{path:"",component:p,children:[{path:":fullname/:apiKey/:tagId",component:(N=function(){function e(t,r,a,i,c,o,s,u,l){n(this,e),this.route=t,this.cdr=r,this.userService=a,this.publisherApiService=i,this.exportDataService=c,this.datePipe=o,this.currencyPipe=s,this.percentPipe=u,this.tagManagementService=l,this.loadingIndicator=!0,this.statData=[],this.range={startDate:"",endDate:""},this.selectedCompany=this.getSelectedCompanyFromLocalStorage()}return a(e,[{key:"ngAfterViewInit",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.route.params.subscribe((function(t){return Object(h.a)(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.paramTagId=t.tagId,this.paramApiKey=t.apiKey,e.next=4,this.getTagInformation(t.tagId);case 4:return this.tagRows=e.sent,this.advertiser=this.tagRows.advertiser,this.statData=[],e.next=9,this.getPublisherAPIData(this.selectedCompany,this.paramApiKey,this.paramTagId,this.range.startDate,this.range.endDate);case 9:return this.statData=e.sent,e.next=12,this.getChartMetrics(this.selectedCompany,this.paramApiKey,this.paramTagId,this.range.startDate,this.range.endDate);case 12:this.chartData=e.sent,this.loadingIndicator=!1,this.cdr.markForCheck();case 15:case"end":return e.stop()}}),e,this)})))}));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getTagInformation",value:function(t){return this.tagManagementService.getOneTag(t).toPromise().then((function(t){return t})).catch((function(t){return t}))}},{key:"getChartMetrics",value:function(e,n,r,a,i){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function c(){var o,s,u,l,p,h,f,b,g,m,d;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,this.publisherApiService.getPublisherAPIStats(e,n,r,a,i).toPromise();case 3:o=c.sent,s={},u=o.reduce((function(t,e){var n=e.date;return s[n]?(s[n].searches+=parseInt(e.searches),e.revenue&&(s[n].revenue+=parseFloat(e.revenue))):(s[n]=Object.assign({},e),t.push(s[n])),t}),[]),l=[],p=[],h=[],f=[],b={},g=t(u);try{for(g.s();!(m=g.n()).done;)d=m.value,l.push(0),p.push(d.revenue),h.push(d.date),f.push(d.searches)}catch(v){g.e(v)}finally{g.f()}return c.abrupt("return",(b.revenuePerDay=l,b.publisherRevenuePerDay=p,b.datesOfRevenue=h,b.searchesPerDay=f,b));case 10:return c.prev=10,c.t0=c.catch(0),c.abrupt("return",c.t0);case 13:case"end":return c.stop()}}),c,this,[[0,10]])})))}},{key:"exportToCsv",value:function(){var e,n=[],r=t(this.statData);try{for(r.s();!(e=r.n()).done;){var a=e.value,i={date:this.datePipe.transform(a.date,"dd MMM yyyy"),subid:a.subid,country:a.country,clicks:a.clicks,searches:a.searches,cpc:this.currencyPipe.transform(a.cpc?a.cpc:0),ctr:this.percentPipe.transform(a.ctr,"1.2-2"),revenue:a.revenue};n.push(i)}}catch(c){r.e(c)}finally{r.f()}this.exportDataService.exportToCsv(n,this.tagRows.nickName?this.tagRows.nickName:this.tagRows.name,["date","subid","country","clicks","searches","cpc","ctr","revenue"])}},{key:"updateReportingFiltering",value:function(t){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.range=t,this.loadingIndicator=!0,this.statData=[],e.t0=this.paramApiKey&&this.paramTagId,!e.t0){e.next=13;break}return e.next=7,this.getPublisherAPIData(this.selectedCompany,this.paramApiKey,this.paramTagId,this.range.startDate,this.range.endDate);case 7:return this.statData=e.sent,e.next=10,this.getChartMetrics(this.selectedCompany,this.paramApiKey,this.paramTagId,this.range.startDate,this.range.endDate);case 10:this.chartData=e.sent,this.loadingIndicator=!1,this.cdr.markForCheck();case 13:case"end":return e.stop()}}),e,this)})))}},{key:"getSelectedCompanyFromLocalStorage",value:function(){return this.userService.getSelectedCompanyFromLocalStorage()}},{key:"getPublisherAPIData",value:function(t,e,n,r,a){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,this.publisherApiService.getPublisherAPIStats(t,e,n,r,a).toPromise();case 3:return i.abrupt("return",i.sent.slice().sort((function(t,e){return e.date-t.date})));case 6:return i.prev=6,i.t0=i.catch(0),i.abrupt("return",i.t0);case 9:case"end":return i.stop()}}),i,this,[[0,6]])})))}},{key:"toggleExpandRow",value:function(t){this.table.rowDetail.toggleExpandRow(t)}},{key:"onDetailToggle",value:function(t){}}]),e}(),N.\u0275fac=function(t){return new(t||N)(l.Qb(u.a),l.Qb(l.i),l.Qb(f.a),l.Qb(d),l.Qb(v.a),l.Qb(s.f),l.Qb(s.d),l.Qb(s.w),l.Qb(y.a))},N.\u0275cmp=l.Kb({type:N,selectors:[["app-tag-api"]],viewQuery:function(t,e){var n;1&t&&l.Tc(x,!0),2&t&&l.zc(n=l.ic())&&(e.table=n.first)},decls:32,vars:10,consts:[[3,"onDatesPicked"],[3,"chartData",4,"ngIf"],[1,"row","py-6"],[1,"btn","btn-sm","btn-primary","mx-3",3,"click"],[1,"material","fullscreen","expandable",2,"top","10px","height","500px",3,"loadingIndicator","columnMode","headerHeight","footerHeight","rowHeight","scrollbarV","scrollbarH","rows"],["expandableTable",""],["name","date"],["ngx-datatable-header-template",""],["ngx-datatable-cell-template",""],["name","subid"],["name","clicks"],["name","monetizedSearches",4,"ngIf"],["name","searches"],["name","country"],["name","cpc"],["name","ctr"],["name","revenue"],[3,"chartData"],["name","monetizedSearches"]],template:function(t,e){1&t&&(l.Wb(0,"app-reporting-filtering",0),l.hc("onDatesPicked",(function(t){return e.updateReportingFiltering(t)})),l.Vb(),l.Mc(1,P,1,1,"app-reporting-publisher-revenue-chart",1),l.Wb(2,"div",2),l.Wb(3,"button",3),l.hc("click",(function(){return e.exportToCsv()})),l.Oc(4," Export Stats "),l.Vb(),l.Vb(),l.Wb(5,"ngx-datatable",4,5),l.Wb(7,"ngx-datatable-column",6),l.Mc(8,M,1,0,"ng-template",7),l.Mc(9,S,3,3,"ng-template",8),l.Vb(),l.Wb(10,"ngx-datatable-column",9),l.Mc(11,I,1,0,"ng-template",7),l.Mc(12,O,2,1,"ng-template",8),l.Vb(),l.Wb(13,"ngx-datatable-column",10),l.Mc(14,R,1,0,"ng-template",7),l.Mc(15,V,3,3,"ng-template",8),l.Vb(),l.Mc(16,T,3,0,"ngx-datatable-column",11),l.Wb(17,"ngx-datatable-column",12),l.Mc(18,W,1,0,"ng-template",7),l.Mc(19,K,2,1,"ng-template",8),l.Vb(),l.Wb(20,"ngx-datatable-column",13),l.Mc(21,j,1,0,"ng-template",7),l.Mc(22,Q,2,1,"ng-template",8),l.Vb(),l.Wb(23,"ngx-datatable-column",14),l.Mc(24,H,1,0,"ng-template",7),l.Mc(25,F,4,7,"ng-template",8),l.Vb(),l.Wb(26,"ngx-datatable-column",15),l.Mc(27,z,1,0,"ng-template",7),l.Mc(28,U,4,7,"ng-template",8),l.Vb(),l.Wb(29,"ngx-datatable-column",16),l.Mc(30,E,1,0,"ng-template",7),l.Mc(31,L,3,4,"ng-template",8),l.Vb(),l.Vb()),2&t&&(l.Db(1),l.rc("ngIf",e.chartData),l.Db(4),l.rc("loadingIndicator",e.loadingIndicator)("columnMode","force")("headerHeight",50)("footerHeight",0)("rowHeight",50)("scrollbarV",!0)("scrollbarH",!0)("rows",e.statData),l.Db(11),l.rc("ngIf","perion"==e.advertiser))},directives:[D.a,s.p,w.d,w.b,w.c,w.a,k.a],pipes:[s.f,s.g,s.d,s.w],styles:[""]}),N),pathMatch:"full"},{path:"",redirectTo:"",pathMatch:"full"},{path:"**",redirectTo:"",pathMatch:"full"}]}],$=((X=function t(){n(this,t)}).\u0275mod=l.Ob({type:X}),X.\u0275inj=l.Nb({factory:function(t){return new(t||X)},imports:[[u.k.forChild(J)],u.k]}),X),_=i("UKGz"),q=((G=function t(){n(this,t)}).\u0275mod=l.Ob({type:G}),G.\u0275inj=l.Nb({factory:function(t){return new(t||G)},providers:[s.f,s.w,s.d],imports:[[u.k,s.c,$,_.a,w.g]]}),G)}}])}();